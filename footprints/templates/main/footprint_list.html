{% extends 'base.html' %}
{% load compress %}

{% block title %}Browse{% endblock %}

{% block js %}
    {% compress js %}
        <script src="{{STATIC_URL}}js/jquery-circle-progress/circle-progress.js"></script>
    {% endcompress %}

    <script type="text/javascript">    
        jQuery(document).ready(function() {
            jQuery('.percent-complete').each(function() {
                var pct = parseInt(jQuery(this).data('value'), 10) / 100;
                jQuery(this).circleProgress({
                    animation: false,
                    value: pct,
                    size: 50,
                    startAngle: -Math.PI/2,
                    label: jQuery(this).data('value') + '%',
                    fill: {
                        color: '#97421b'  //'#2e5367'
                    }
                });
            });
        });
    </script>
{% endblock %}

{% block content %}

<div class="page-header">
  <h1>Browse Footprints</h1>
</div>

<div class="object-browse">
    <div class="row tools">
        <div class="col-sm-6">
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle"
                data-toggle="dropdown" aria-expanded="false">
                Sort By {{sort_selected}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                {% for key, value in sort_options.items %}
                    <li>
                        <a href="{% url 'browse-footprint-list' key %}">
                            {{value.label}}
                            {% ifequal sort_selected value.label %}<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> {% endifequal %} 
                        </a>
                    </li>
                {% endfor %}
              </ul>
            </div>
        </div>
        <div class="col-sm-6">
            {% if paginator.num_pages > 1 %}
                <ul class="pagination pagination-sm pull-right">
                    {% for a_page in paginator.page_range %}
                        {% ifequal page_obj.number a_page %}
                            <li class="active"><a class="page-link disabled"
                        {% else %}
                            <li><a class="page-link"
                        {% endifequal %}
                            href="?page={{ a_page }}">{{a_page}}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}
            <div class="pull-right page-count">
                {{page_obj.start_index}} - {{page_obj.end_index}} of {{paginator.count}} items
            </div>
            <div class="clearfix"></div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-footprints">
            <tr>
                <th class="footprint-title">Footprint</th>
                <th class="evidence-location">Evidence Location</th>
                <th class="owners">Owners</th>
                <th class="work-title">Literary Work</th>
                <th class="imprint-date">Imprint</th>
                <th class="added">Added</th>
                <th class="percent-complete-header">Complete</th>
            </tr>
            {% for footprint in object_list %}
                <tr>
                    <td>
                        <a href="/footprint/{{footprint.id}}">
                        <div>{{footprint.title}}</div>
                        {% if footprint.associated_date %}
                            <div>{{footprint.associated_date}}</div>
                        {% endif %}
                        {% if footprint.place %}
                            <div>{{footprint.place}}</div>
                        {% endif %}</a>
                    </td>
                    <td>{{footprint.provenance}}</td>
                    <td>
                        {% for owner in footprint.owners %}
                            {{owner.display_name}}
                            {% if not forloop.last %},{% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        <a href="/writtenwork/{{footprint.book_copy.imprint.work.id}}">
                            {{footprint.book_copy.imprint.work.title|default:"n/a"}}
                        </a><br />                     
                    </td>
                    <td>
                        {% if footprint.book_copy.imprint.printers.count > 0 %}
                            <div>
                                {% for printer in footprint.book_copy.imprint.printers %}
                                    {{printer.display_name}}
                                    {% if not forloop.last %},{% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                        {% if footprint.book_copy.imprint.date_of_publication %}
                            <div>{{footprint.book_copy.imprint.date_of_publication}}</div>
                        {% endif %}
                        {% if footprint.book_copy.imprint.place %}
                            <div>{{footprint.book_copy.imprint.place}}</div>
                        {% endif %}
                    </td>
                    <td>
                        {{footprint.created_at|date:"m/d/y"}}
                    </td>
                    <td class="percent-complete-cell">
                        <div class="percent-complete" data-value="{{footprint.percent_complete}}">
                        </div> 
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    
    {% if is_paginated %}
        <nav>
            <ul class="pager">
                {% if page_obj.has_previous %}
                    <li><a href="?page={{ page_obj.previous_page_number }}">&laquo; Previous</a></li>
                {% else %}
                    <li class="disabled"><a href="#">&laquo; Previous</a>
                {% endif %}
                {% if page_obj.has_next %}
                    <li><a href="?page={{ page_obj.next_page_number }}">Next &raquo;</a></li>
                {% else %}
                    <li class="disabled"><a href="#">Next &raquo;</a>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
</div>

{% endblock %}